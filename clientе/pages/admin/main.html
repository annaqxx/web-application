<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ MathUniverse</title>
    <link rel="stylesheet" href="main.css">
    <script type="module">
        import { api } from '../../shared/api.js';
        
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const user = JSON.parse(localStorage.getItem('user'));
                const token = localStorage.getItem('token');
                
                if (!token || !user || user.role !== 'admin') {
                    window.location.href = '../../pages/auth/login.html';
                    return;
                }
                
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–æ–∫–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
                await api.checkAuth();
                
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = '../../pages/auth/login.html';
            }
        });
    </script>
</head>
<body class="light">
    <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', () => {
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user'));
        
        if (!token || !user || user.role !== 'admin') {
        window.location.href = '../../pages/auth/login.html';
        return;
        }
        
        // –û—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
    })
    </script>
    <header class="navbar">
        <div class="wrapper site-header_wrapper">
            <div class="title">
                <img id="logo" src="../images/university-icon.png" alt="MathUniverse" class="logo" />
                <h2>MathUniverse</h2>
            </div>
            <div class="controls">
                <button id="theme-toggle">
                <img id="theme-icon" src="../images/sun-icon.png" alt="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É" />
                </button>
                <button id="logout-btn" class="logout">–í—ã—Ö–æ–¥</button>
            </div>
        </div>
    </header>

    <div class="admin-container">
        <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
        <aside class="admin-sidebar">
            <nav class="admin-nav">
                <button class="admin-nav-btn active" data-section="users">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</button>
                <button class="admin-nav-btn" data-section="groups">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏</button>
                <button class="admin-nav-btn" data-section="stats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π</button>
            </nav>
        </aside>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
        <main class="admin-main">
            <!-- –°–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <section id="users-section" class="admin-section active">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
                <div class="admin-actions">
                    <button id="add-user-btn" class="admin-action-btn">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                    <div class="admin-search">
                        <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...">
                        <button>–ù–∞–π—Ç–∏</button>
                    </div>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>–ò–º—è</th>
                                <th>Email</th>
                                <th>–†–æ–ª—å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è –≥—Ä—É–ø–ø -->
            <section id="groups-section" class="admin-section">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏</h2>
                <div class="admin-actions-group">
                    <button id="add-group-btn" class="admin-action-btn">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                    <button id="assign-teacher-btn" class="admin-action-btn">–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</button>
                </div>
                <div class="admin-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>ID –≥—Ä—É–ø–ø—ã</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</th>
                                <th>–°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
            <section id="stats-section" class="admin-section">
                <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Å–µ—â–µ–Ω–∏–π</h2>
                <div class="admin-filters">
                    <select id="stats-period">
                        <option value="day">–ó–∞ –¥–µ–Ω—å</option>
                        <option value="week">–ó–∞ –Ω–µ–¥–µ–ª—é</option>
                        <option value="month">–ó–∞ –º–µ—Å—è—Ü</option>
                    </select>
                    <input type="date" id="stats-date">
                </div>
                <div class="stats-container">
                    <div class="stats-chart">
                        <!-- –ì—Ä–∞—Ñ–∏–∫ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                        <canvas id="login-stats-chart"></canvas>
                    </div>
                    <div class="stats-table-container">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                                    <th>–ö–æ–ª-–≤–æ –≤—Ö–æ–¥–æ–≤</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="ss.js"></script>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
            <form id="user-form">
                <input type="hidden" id="user-id">
                <div class="form-group">
                    <label for="user-name">–ò–º—è:</label>
                    <input type="text" id="user-name" required>
                </div>
                <div class="form-group">
                    <label for="user-email">Email:</label>
                    <input type="email" id="user-email" required>
                </div>
                <div class="form-group">
                    <label for="user-password">–ü–∞—Ä–æ–ª—å:</label>
                    <div class="password-container">
                        <input type="password" id="user-password" required>
                        <span class="toggle-password">üëÅÔ∏è</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="user-role">–†–æ–ª—å:</label>
                    <select id="user-role" required>
                        <option value="student">–°—Ç—É–¥–µ–Ω—Ç</option>
                        <option value="teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                <button type="submit" class="submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div id="group-modal" class="modal">
        <div class="modal-content">
            <span class="close-group-modal">&times;</span>
            <h2 id="group-modal-title">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h2>
            <form id="group-form">
                <input type="hidden" id="group-id">
                <div class="form-group">
                    <label for="group-name">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:</label>
                    <input type="text" id="group-name" required>
                </div>
                <div class="form-group">
                    <label for="group-teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:</label>
                    <select id="group-teacher" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</option>
                        <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label>–°—Ç—É–¥–µ–Ω—Ç—ã:</label>
                    <button type="button" id="select-students-btn" class="admin-action-btn" 
                            style="margin-bottom: 10px;">
                        –í—ã–±—Ä–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
                    </button>
                    <div id="selected-students-preview" class="selected-students-preview">
                        <!-- –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
                    </div>
                </div>
                <button type="submit" class="submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <!-- –ù–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ -->
    <div id="select-students-modal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-select-students">&times;</span>
            <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</h2>
            <div class="search-container">
                <input type="text" id="student-search" placeholder="–ü–æ–∏—Å–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤...">
            </div>
            <div class="select-students-list" id="select-students-list">
                <!-- –°–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —á–µ—Ä–µ–∑ JS -->
            </div>
            <button id="confirm-students" class="submit-btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–±–æ—Ä</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è -->
    <div id="assign-teacher-modal" class="modal">
        <div class="modal-content">
            <span class="close-assign-modal">&times;</span>
            <h2>–ù–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</h2>
            <form id="assign-teacher-form">
                <div class="form-group">
                    <label for="select-group">–ì—Ä—É–ø–ø–∞:</label>
                    <select id="select-group" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                        <!-- –ì—Ä—É–ø–ø—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="select-teacher">–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å:</label>
                    <select id="select-teacher" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è</option>
                        <!-- –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                    </select>
                </div>
                <button type="submit" class="submit-btn">–ù–∞–∑–Ω–∞—á–∏—Ç—å</button>
            </form>
        </div>
    </div>
</body>
</html>